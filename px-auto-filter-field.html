<link rel="import" href="../polymer/polymer-element.html"/>
<link rel="import" href="px-data-grid-theme.html">
<link rel="import" href="../px-icon-set/px-icon.html">
<link rel="import" href="../app-localize-behavior/app-localize-behavior.html"/>

<dom-module id="px-auto-filter-field">
  <template>
    <style include="px-data-grid-styles">

      :host {
        position: relative;
        display: block;
      }

      .search__form {
        position: relative;
        display: inline-block;
      }

      .search__icon {
        --iron-icon-stroke-color: var(--px-base-text-color);
        position: absolute;
        top: 0;
        right: 0;
        display: block;
        padding: 4px;
        pointer-events: none;
        -ms-user-select: none;
        user-select: none;
      }

      .text-input {
        padding-right: 22px;
      }

    </style>
    <div class="search__form">
      <input
        id="search-field"
        class="text-input input--tiny search__box"
        type="text"
        name="autofilter"
        value="{{value::input}}"
        placeholder="{{placeholder}}"
      >
      </input>
      <px-icon class="search__icon" icon="px-utl:search"></px-icon>
    </div>
  </template>
  <script>
    {
      /**
       * Auto filtering field used by px-data-grid
       *
       * @memberof Predix
       * @extends Polymer.Element
       */
      class AutoFilterFieldElement extends Polymer.Element {
        static get is() {
          return 'px-auto-filter-field';
        }

        static get properties() {
          return {

            /**
             * Placeholder text shown in field
             */
            placeholder: {
              type: String
            },

            /**
             * Timeout value in milliseconds
             */
            timeout: {
              type: Number,
              value: 400
            },

            value: {
              type: String,
              notify: true,
              observer: '_onChange'
            }
          };
        }

        ready() {
          super.ready();
        }

        _onChange() {
          this._renderDebouncer = Polymer.Debouncer.debounce(
            this._renderDebouncer,
            Polymer.Async.timeOut.after(this.timeout), () => {
              this.dispatchEvent(new CustomEvent('filter-change', {
                detail: {
                  value: this.value
                },
                bubbles: true
              }));
            });
        }
      }

      customElements.define(AutoFilterFieldElement.is, AutoFilterFieldElement);

      /**
       * @namespace Predix
       */
      window.Predix = window.Predix || {};
      Predix.AutoFilterFieldElement = AutoFilterFieldElement;
    }
  </script>
</dom-module>
