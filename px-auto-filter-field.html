<link rel="import" href="../polymer/polymer-element.html"/>
<link rel="import" href="px-data-grid-theme.html">
<link rel="import" href="../app-localize-behavior/app-localize-behavior.html"/>

<dom-module id="px-auto-filter-field">
  <template>
    <style include="px-data-grid-styles">

      :host {
        position: relative;
        display: block;
      }

      .text-input {
        background: var(--px-auto-filter-field-background, none);
        background-size: auto 70%;
        background-position: right center;
        padding-right: 20px;
      }

    </style>
    <input
      id="search-field"
      class="text-input input--tiny"
      type="text"
      name="autofilter"
      value="{{value::input}}"
      placeholder="{{placeholder}}"
    >
    </input>
  </template>
  <script>
    {
      /**
       * Auto filtering field used by px-data-grid
       *
       * @memberof Predix
       * @extends Polymer.Element
       */
      class AutoFilterFieldElement extends Polymer.Element {
        static get is() {
          return 'px-auto-filter-field';
        }

        static get properties() {
          return {

            /**
             * Placeholder text shown in field
             */
            placeholder: {
              type: String
            },

            /**
             * Timeout value in milliseconds
             */
            timeout: {
              type: Number,
              value: 400
            },

            value: {
              type: String,
              observer: '_onChange'
            }
          };
        }

        ready() {
          super.ready();
        }

        _onChange() {
          this._renderDebouncer = Polymer.Debouncer.debounce(
            this._renderDebouncer,
            Polymer.Async.timeOut.after(this.timeout), () => {
              this.dispatchEvent(new CustomEvent('filter-change', {
                detail: {
                  value: this.value
                },
                bubbles: true
              }));
            });
        }
      }

      customElements.define(AutoFilterFieldElement.is, AutoFilterFieldElement);

      /**
       * @namespace Predix
       */
      window.Predix = window.Predix || {};
      Predix.AutoFilterFieldElement = AutoFilterFieldElement;
    }
  </script>
</dom-module>
