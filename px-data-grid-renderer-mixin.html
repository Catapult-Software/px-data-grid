<script>
  window.Predix = window.Predix || {};
  /**
   * Mixin, that provides common functionality for all renderers.
   * You need to implement this mixin in your own renderers.
   *
   * @polymerMixin
   */
  Predix.DataGridRendererMixin = superClass => class DataGridRendererMixin extends superClass {
    static get properties() {
      return {
        _editing: {
          type: Boolean,
          observer: '_editingChanged'
        },

        value: {
          type: String
        },

        initialValue: {
          type: String
        },

        validationResult: {
          type: Object
        },

        column: {
          type: Object
        },

        localize: Function
      };
    }

    static get observers() {
      return [
        '_initialValueObserver(initialValue)'
      ];
    }

    ready() {
      super.ready();

      if (this.$.editingTemplate) {
        this._editingTemplateDisplay = window.getComputedStyle(this.$.editingTemplate).getPropertyValue('display');
        this.$.editingTemplate.style.display = 'none';
      }

      if (this.$.value) {
        this._valueDisplay = window.getComputedStyle(this.$.value).getPropertyValue('display');
      }
    }

    _editingChanged(editing, oldVal) {

      this.dispatchEvent(new CustomEvent('renderer-editing-changed', {
        bubbles: true,
        composed: true,
        detail: {
          renderer: this
        }
      }));
      this._performValidation();

      if (editing) {
        this._computedHeight = window.getComputedStyle(this).height;

        this.$.value.style.display = 'none';
        this.$.editingTemplate.style.display = this._editingTemplateDisplay;

        this.style.height = this._computedHeight;

      } else {
        this.$.value.style.display = this._valueDisplay;
        this.$.editingTemplate.style.display = 'none';
      }
    }

    _initialValueObserver(value) {
      this.value = value;
    }

    restoreInitial() {
      this.value = this.initialValue;
    }

    _performValidation() {
      this.validationResult = this.validate();

      return this.validationResult;
    }

    validate() {
      return {
        valid: true
      };
    }

    applyValue() {
      this.dispatchEvent(new CustomEvent('value-changed', {
        bubbles: true,
        detail: {
          value: this.value
        }
      }));
    }

  };
</script>
