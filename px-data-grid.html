<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../vaadin-grid/vaadin-grid.html">
<link rel="import" href="../vaadin-grid/vaadin-grid-selection-column.html">
<link rel="import" href="../vaadin-grid/vaadin-grid-sorter.html">
<link rel="import" href="px-data-grid-column.html">
<link rel="import" href="px-data-grid-theme.html">

<dom-module id="px-data-grid">
  <template>
    <vaadin-grid aria-label="Basic Binding Example" items="[[tableData]]" theme="row-stripes" multi-sort>

      <template is="dom-if" if="[[selectable]]" restamp>
        <vaadin-grid-selection-column auto-select>
        </vaadin-grid-selection-column>
      </template>

      <template is="dom-repeat" items="[[_tableColumns]]" as="column">
        <px-data-grid-column>
          <template class="header">
            <vaadin-grid-sorter path="[[column]]">[[column]]</vaadin-grid-sorter>
          </template>
          <template>[[get(column, item)]]</template>
        </px-data-grid-column>
      </template>

    </vaadin-grid>
  </template>
  <script>
    {
      class DataGridElement extends Polymer.Element {
        static get is() {
          return 'px-data-grid';
        }

        static get properties() {
          return {

            /**
             * Data for the table to display.
             *
             * Expected data format is a JSON array of objects. Each object in the array represents a row in the table.
             *
             * Each item in an object will be displayed as a separate column, unless px-data-table-columns are
             * defined to limit which columns are displayed.
             */
            tableData: {
              type: Array,
              value: function() {
                return [];
              },
              observer: '_tableDataChanged',
              notify: true
            },

            /**
             * Use the selectable property if one or more rows within the table should be selectable. See also `singleSelect`.
             */
            selectable: {
              type: Boolean,
              value: false
            },

            /**
             * In case px-data-table-columns aren't provided, table columns will be generated automatically.
             * They will be stamped via
             *
             * <template is="dom-repeat" items="[[_tableColumns]]">
             *   ...
             * </template>
             *
             * @private
             */
            _tableColumns: {
              type: Array
            }
          };
        }

        _tableDataChanged(tableData) {
          if (tableData && tableData.length) {
            this._tableColumns = [];
            for (const key in tableData[0]) {
              this._tableColumns.push(key);
            }
          }
        }
      }
      customElements.define(DataGridElement.is, DataGridElement);

      /**
       * @namespace Predix
       */
      window.Predix = window.Predix || {};
      Predix.DataGridElement = DataGridElement;
    }
  </script>
</dom-module>
